
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BI Stealth System</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&family=Inter:wght@400;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background: #050505; color: #fff; margin: 0; user-select: none; overflow: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        #gatekeeper {
            position: fixed; inset: 0; background: #000; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.5s ease-out;
            pointer-events: none; /* Permite clicks a través si se queda pegado visualmente */
        }
        
        .scanner-line {
            width: 100%; height: 2px; background: rgba(59, 130, 246, 0.5);
            position: absolute; top: 0; left: 0; animation: scan 2s linear infinite;
            box-shadow: 0 0 15px #3b82f6;
        }

        @keyframes scan {
            0% { top: 0%; }
            100% { top: 100%; }
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        iframe { background: #1a1a1a; }
    </style>

    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom": "https://esm.sh/react-dom@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body oncontextmenu="return false;">
    <div id="gatekeeper">
        <div class="scanner-line"></div>
        <div class="mb-6 w-12 h-12 border-t-2 border-blue-500 rounded-full animate-spin"></div>
        <h2 class="mono text-[10px] tracking-[0.6em] text-blue-500 uppercase font-black animate-pulse">Establishing_Secure_Link</h2>
    </div>

    <div id="root"></div>

    <script>
        // Protección básica contra inspección
        document.onkeydown = e => {
            if (e.keyCode == 123 || (e.ctrlKey && e.shiftKey && [73, 67, 74].includes(e.keyCode)) || (e.ctrlKey && e.keyCode == 85)) {
                return false;
            }
        };
    </script>

    <script type="text/babel" data-type="module" data-presets="react,typescript">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';

        // v14 fuerza el reseteo de la caché para cargar las nuevas URLs corregidas
        const VAULT_KEY = 'v14_stealth_config';

        // Utilidad de reconstrucción segura (Base64 Fragmentado)
        // Esto evita que "powerbi.com" aparezca como texto plano en el código fuente
        const reconstruct = (parts) => {
            try {
                return atob(parts.join(''));
            } catch (e) {
                console.error("Link corruption detected");
                return "";
            }
        };

        // DATOS OFUSCADOS (Split Base64)
        // Fragmentos diseñados para romper la firma de texto de la URL
        
        // URL 1: INGRESOS
        const LINK_INGRESOS = [
            "aHR0cHM6Ly9hcHAucG93ZXJiaS5jb20vcmVwb3J0RW1iZWQ/cmVwb3J0SWQ9NDZmZWM1NmYtZmZkOC00NWJhLWE3NjktODQyZTE0YTQyZmU3",
            "JmF1dG9BdXRoPXRydWUmY3RpZD04NTNlN2MyMy1jNTY0LTQ5YmQtOTk2Yy1lOGRhZTE3ODZiOTYmZmlsdGVyPVBST1lFQ1RPJTJGT0lEK2VxKzEmZmlsdGVyUGFuZUVuYWJsZWQ9ZmFsc2U="
        ];

        // URL 2: FACTURACION
        const LINK_FACTURACION = [
            "aHR0cHM6Ly9hcHAucG93ZXJiaS5jb20vcmVwb3J0RW1iZWQ/cmVwb3J0SWQ9N2NkZWNiM2EtMDA4My00MGE4LTg1YWMtNjMyNzBhMWQ4MTQ0",
            "JmF1dG9BdXRoPXRydWUmY3RpZD04NTNlN2MyMy1jNTY0LTQ5YmQtOTk2Yy1lOGRhZTE3ODZiOTYmZmlsdGVyPVBST1lFQ1RPJTJGT0lEK2VxKzEmZmlsdGVyUGFuZUVuYWJsZWQ9ZmFsc2U="
        ];

        const INITIAL = [
            { id: '1', name: 'INGRESOS', parts: LINK_INGRESOS },
            { id: '2', name: 'FACTURACION', parts: LINK_FACTURACION }
        ];

        const App = () => {
            const [nodes, setNodes] = useState(INITIAL);
            const [selected, setSelected] = useState(INITIAL[0].id);
            const [showSettings, setShowSettings] = useState(false);
            const [iframeLoading, setIframeLoading] = useState(true);

            useEffect(() => {
                // Sistema de auto-liberación del loader
                // Si el iframe tarda mucho o falla silenciosamente, quitamos el loader a los 2.5s
                // para que el usuario pueda ver el error real de Power BI si existe.
                const timer = setTimeout(() => {
                    const loader = document.getElementById('gatekeeper');
                    if (loader) {
                        loader.style.opacity = '0';
                        setTimeout(() => loader.remove(), 500);
                    }
                }, 2500);

                // Cargar configuración guardada si existe (opcional, priorizamos INITIAL en esta versión para arreglar el error)
                const saved = localStorage.getItem(VAULT_KEY);
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        if(parsed && parsed.length > 0) setNodes(parsed);
                    } catch(e) {}
                }

                return () => clearTimeout(timer);
            }, []);

            const updateNodes = (newNodes) => {
                setNodes(newNodes);
                localStorage.setItem(VAULT_KEY, JSON.stringify(newNodes));
            };

            const activeNode = nodes.find(n => n.id === selected);
            // Reconstruir URL al vuelo
            const activeUrl = activeNode ? (activeNode.parts ? reconstruct(activeNode.parts) : activeNode.url) : "";

            return (
                <div className="flex h-screen w-full bg-[#050505]">
                    {/* Sidebar */}
                    <aside className="w-16 md:w-64 bg-black border-r border-blue-900/20 flex flex-col z-10 shadow-2xl relative">
                        <div className="p-8 border-b border-blue-900/10 mb-6">
                            <div className="flex items-center gap-3">
                                <div className="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></div>
                                <span className="mono text-[9px] font-black text-white tracking-[0.3em] uppercase hidden md:block italic">Secure_Hub</span>
                            </div>
                        </div>

                        <div className="flex-1 px-4 space-y-3 overflow-y-auto no-scrollbar">
                            {nodes.map(n => (
                                <button
                                    key={n.id}
                                    onClick={() => { 
                                        if (selected !== n.id) {
                                            setSelected(n.id); 
                                            setIframeLoading(true); 
                                        }
                                    }}
                                    className={`w-full p-4 rounded-xl transition-all duration-300 mono text-[9px] font-bold tracking-widest text-left uppercase flex items-center gap-4 ${selected === n.id ? 'bg-blue-900/20 text-blue-400 border border-blue-500/20 shadow-[0_0_15px_rgba(59,130,246,0.1)]' : 'text-zinc-600 hover:text-zinc-300 hover:bg-zinc-900/50'}`}
                                >
                                    <span className={`w-1.5 h-1.5 rounded-full ${selected === n.id ? 'bg-blue-400' : 'bg-zinc-700'}`}></span>
                                    <span className="hidden md:block truncate">{n.name}</span>
                                    <span className="md:hidden">{n.name[0]}</span>
                                </button>
                            ))}
                        </div>

                        <div className="p-6">
                            <button onClick={() => setShowSettings(true)} className="w-full py-3 bg-zinc-950 border border-zinc-900 rounded-xl text-[8px] mono font-black text-zinc-600 tracking-[0.2em] hover:bg-zinc-900 hover:text-white transition-all uppercase hover:border-zinc-700">
                                Config
                            </button>
                        </div>
                    </aside>

                    {/* Visor */}
                    <main className="flex-1 flex flex-col relative overflow-hidden bg-[#0a0a0a]">
                        {activeNode ? (
                            <div className="w-full h-full flex flex-col relative">
                                <div className="absolute top-4 right-6 z-20 pointer-events-none">
                                    <div className="flex items-center gap-2">
                                        <div className={`w-1.5 h-1.5 rounded-full ${iframeLoading ? 'bg-yellow-500 animate-ping' : 'bg-green-500'}`}></div>
                                        <span className="mono text-[8px] text-zinc-500 tracking-widest uppercase">{iframeLoading ? 'RECEIVING_STREAM...' : 'LINK_ESTABLISHED'}</span>
                                    </div>
                                </div>
                                
                                <iframe
                                    key={activeNode.id}
                                    src={activeUrl}
                                    className="w-full h-full border-none opacity-0 transition-opacity duration-700 ease-in-out"
                                    style={{ opacity: 1 }}
                                    onLoad={() => setIframeLoading(false)}
                                    allowFullScreen={true}
                                />
                            </div>
                        ) : (
                            <div className="flex-1 flex items-center justify-center mono text-zinc-800 text-[10px] tracking-[1em]">SIGNAL_LOST</div>
                        )}
                    </main>

                    {/* Settings Modal */}
                    {showSettings && (
                        <div className="fixed inset-0 z-[100] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4">
                            <div className="w-full max-w-md bg-[#050505] border border-zinc-800 rounded-2xl p-8 shadow-2xl relative">
                                <div className="flex justify-between items-center mb-8 border-b border-zinc-900 pb-4">
                                    <h3 className="mono font-bold text-white text-[10px] tracking-[0.4em] uppercase">Override_Protocol</h3>
                                    <button onClick={() => setShowSettings(false)} className="text-zinc-600 hover:text-white transition-colors">✕</button>
                                </div>

                                <form onSubmit={(e) => {
                                    e.preventDefault();
                                    const n = e.target.node_name.value.toUpperCase();
                                    const u = e.target.node_url.value;
                                    if(!n || !u) return;
                                    // Al añadir manualmente, guardamos la URL plana o una codificación simple
                                    // ya que el usuario la conoce.
                                    const newN = [...nodes, { 
                                        id: Date.now().toString(), 
                                        name: n, 
                                        parts: [btoa(u)] // Codificación simple para nuevas entradas
                                    }];
                                    updateNodes(newN);
                                    setSelected(newN[newN.length-1].id);
                                    e.target.reset();
                                    setShowSettings(false);
                                }} className="space-y-5">
                                    <input name="node_name" placeholder="IDENTIFICADOR" className="w-full p-4 bg-zinc-900/50 border border-zinc-800 rounded-lg mono text-[10px] text-white focus:border-blue-900 outline-none transition-all placeholder:text-zinc-700" />
                                    <input name="node_url" placeholder="ENLACE DE ORIGEN" className="w-full p-4 bg-zinc-900/50 border border-zinc-800 rounded-lg mono text-[10px] text-white focus:border-blue-900 outline-none transition-all placeholder:text-zinc-700" />
                                    <button className="w-full py-4 bg-blue-900/20 hover:bg-blue-900/40 text-blue-400 border border-blue-900/50 rounded-lg mono text-[9px] font-bold tracking-[0.2em] uppercase transition-all">
                                        Ejecutar Inserción
                                    </button>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
